dilated_ratio:  [1, 2, 4, 8, 16]
segment_length:  [1024, 5792, 32768, 185363, 1048576]
Number of trainable LongNet parameters:  85148160
Global Pooling: False
slide_encoder.pth: 100%|████████████████████████████████████████████████████████████| 345M/345M [00:31<00:00, 11.0MB/s]
[92m Successfully Loaded Pretrained GigaPath model from hf_hub:prov-gigapath/prov-gigapath [00m
[768, 512, 256]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 22.55it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 22.88it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 22.85it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.17it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.11it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 22.81it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.07it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.01it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.42it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.33it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.32it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.05it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.49it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.10it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.08it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.13it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.26it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.26it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 23.18it/s]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:22<00:00, 22.85it/s]
[768, 512, 256]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:23<00:00, 22.24it/s]
precision: 0.5734767025089605
recall: 0.6060606060606061
auc: 0.5789936769267479
accuracy: 0.5694980694980695
f1: 0.5893186003683242
confusion matrix:
[[135 119]
 [104 160]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:09<00:00, 27.01it/s]
precision: 0.5754189944134078
recall: 0.8046875
auc: 0.6439903846153847
accuracy: 0.6085271317829457
f1: 0.6710097719869706
confusion matrix:
[[ 54  76]
 [ 25 103]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:08<00:00, 29.12it/s]
precision: 0.5245901639344263
recall: 0.8571428571428571
auc: 0.6924535225048924
accuracy: 0.6007751937984496
f1: 0.6508474576271186
confusion matrix:
[[59 87]
 [16 96]]
Save model at epoch 0.
val auc: 0.6439903846153847
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:23<00:00, 21.73it/s]
precision: 0.5964912280701754
recall: 0.6439393939393939
auc: 0.6284672512526843
accuracy: 0.5965250965250966
f1: 0.6193078324225865
confusion matrix:
[[278 230]
 [188 340]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:05<00:00, 44.86it/s]
precision: 0.78125
recall: 0.390625
auc: 0.7045673076923076
accuracy: 0.6434108527131783
f1: 0.5208333333333334
confusion matrix:
[[116  14]
 [ 78  50]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:05<00:00, 50.37it/s]
precision: 0.6615384615384615
recall: 0.38392857142857145
auc: 0.7395425636007827
accuracy: 0.6472868217054264
f1: 0.4858757062146893
confusion matrix:
[[124  22]
 [ 69  43]]
Save model at epoch 1.
val auc: 0.7045673076923076
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:23<00:00, 21.98it/s]
precision: 0.6125592417061612
recall: 0.6527777777777778
auc: 0.6589583499032319
accuracy: 0.6126126126126126
f1: 0.6320293398533008
confusion matrix:
[[435 327]
 [275 517]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:05<00:00, 45.54it/s]
precision: 0.7125
recall: 0.4453125
auc: 0.6837139423076923
accuracy: 0.6356589147286822
f1: 0.5480769230769231
confusion matrix:
[[107  23]
 [ 71  57]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:05<00:00, 48.44it/s]
precision: 0.6282051282051282
recall: 0.4375
auc: 0.7076810176125244
accuracy: 0.6434108527131783
f1: 0.5157894736842106
confusion matrix:
[[117  29]
 [ 63  49]]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:23<00:00, 21.88it/s]
precision: 0.6278643446379468
recall: 0.6486742424242424
auc: 0.6784981955380578
accuracy: 0.625
f1: 0.6380996739636703
confusion matrix:
[[610 406]
 [371 685]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:05<00:00, 46.30it/s]
precision: 0.5741935483870968
recall: 0.6953125
auc: 0.6655048076923078
accuracy: 0.5930232558139535
f1: 0.6289752650176679
confusion matrix:
[[64 66]
 [39 89]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:05<00:00, 48.77it/s]
precision: 0.5575757575757576
recall: 0.8214285714285714
auc: 0.7210127201565557
accuracy: 0.6395348837209303
f1: 0.6642599277978339
confusion matrix:
[[73 73]
 [20 92]]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:23<00:00, 21.77it/s]
precision: 0.6403508771929824
recall: 0.6636363636363637
auc: 0.6938045812455261
accuracy: 0.6386100386100386
f1: 0.6517857142857143
confusion matrix:
[[778 492]
 [444 876]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:05<00:00, 46.63it/s]
precision: 0.7375
recall: 0.4609375
auc: 0.7153846153846154
accuracy: 0.6511627906976745
f1: 0.5673076923076923
confusion matrix:
[[109  21]
 [ 69  59]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:05<00:00, 48.57it/s]
precision: 0.6404494382022472
recall: 0.5089285714285714
auc: 0.7191780821917809
accuracy: 0.6627906976744186
f1: 0.5671641791044776
confusion matrix:
[[114  32]
 [ 55  57]]
Save model at epoch 4.
val auc: 0.7153846153846154
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:23<00:00, 21.86it/s]
precision: 0.6476426799007444
recall: 0.6590909090909091
auc: 0.7034849810440362
accuracy: 0.6435006435006435
f1: 0.6533166458072591
confusion matrix:
[[ 956  568]
 [ 540 1044]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:05<00:00, 45.93it/s]
precision: 0.6356589147286822
recall: 0.640625
auc: 0.6970552884615383
accuracy: 0.6395348837209303
f1: 0.6381322957198443
confusion matrix:
[[83 47]
 [46 82]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:05<00:00, 48.56it/s]
precision: 0.5899280575539568
recall: 0.7321428571428571
auc: 0.748165362035225
accuracy: 0.6627906976744186
f1: 0.6533864541832669
confusion matrix:
[[89 57]
 [30 82]]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:23<00:00, 21.79it/s]
precision: 0.6548387096774193
recall: 0.6590909090909091
auc: 0.7116108254325352
accuracy: 0.649200220628792
f1: 0.656957928802589
confusion matrix:
[[1136  642]
 [ 630 1218]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:05<00:00, 47.30it/s]
precision: 0.5656565656565656
recall: 0.875
auc: 0.6974759615384615
accuracy: 0.6046511627906976
f1: 0.6871165644171779
confusion matrix:
[[ 44  86]
 [ 16 112]]
100%|████████████████████████████████████████████████████████████████████████████████| 258/258 [00:05<00:00, 49.97it/s]
precision: 0.5233160621761658
recall: 0.9017857142857143
auc: 0.7119006849315068
accuracy: 0.6007751937984496
f1: 0.6622950819672131
confusion matrix:
[[ 54  92]
 [ 11 101]]
100%|████████████████████████████████████████████████████████████████████████████████| 518/518 [00:24<00:00, 21.54it/s]
precision: 0.6608736496007516
recall: 0.6661931818181818
auc: 0.7206914742901456
accuracy: 0.6556467181467182
f1: 0.6635227540674369
confusion matrix:
[[1310  722]
 [ 705 1407]]
 93%|██████████████████████████████████████████████████████████████████████████▍     | 240/258 [00:05<00:00, 44.73it/s]
Traceback (most recent call last):
  File "/work/PAMIL_two_round/train.py", line 88, in <module>
    main(args)
  File "/work/PAMIL_two_round/train.py", line 81, in main
    train(args,basedmodel,ppo,classifier_chief, classifier_giga,FusionHisF, gigapath_model, memory,train_dataloader, validation_dataloader, test_dataloader, wandb)
  File "/work/PAMIL_two_round/utilmodule/core.py", line 401, in train
    precision, recall, f1, val_auc, val_accuracy = test(args,basedmodel,ppo,classifier_chief,FusionHisF,memory_space,validation_loader, chief_model, "val", epoch)
  File "/work/PAMIL_two_round/utilmodule/core.py", line 32, in test
    for idx, (coords, chief_data, gigapath_data, label) in enumerate (tqdm(test_loader)):
  File "/opt/conda/lib/python3.10/site-packages/tqdm/std.py", line 1195, in __iter__
    for obj in iterable:
  File "/opt/conda/lib/python3.10/site-packages/torch/utils/data/dataloader.py", line 634, in __next__
    data = self._next_data()
  File "/opt/conda/lib/python3.10/site-packages/torch/utils/data/dataloader.py", line 678, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
  File "/opt/conda/lib/python3.10/site-packages/torch/utils/data/_utils/fetch.py", line 51, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
  File "/opt/conda/lib/python3.10/site-packages/torch/utils/data/_utils/fetch.py", line 51, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
  File "/work/PAMIL_two_round/datasets/load_datasets.py", line 35, in __getitem__
    structured_coords = coods_file['coords'][:]
  File "h5py/_objects.pyx", line 56, in h5py._objects.with_phil.wrapper
  File "h5py/_objects.pyx", line 57, in h5py._objects.with_phil.wrapper
  File "/opt/conda/lib/python3.10/site-packages/h5py/_hl/dataset.py", line 903, in __getitem__
    self.id.read(mspace, fspace, arr, mtype, dxpl=self._dxpl)
KeyboardInterrupt
